<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>RDO ‚Ä¢ Progression Animaux L√©gendaires</title>

<style>
  /* ---------- THEME SYSTEM ---------- */
  :root{
    --radius-card:16px; --radius-input:12px; --radius-tick:12px;
    --fs-base:16px; --gap-page:16px; --gap-card:10px;
    --touch:48px;
  }
  :root[data-theme="dark"]{
    --bg:#0c0f15; --card:#131926; --ink:#eef1f5; --muted:#9aa4b2; --line:#263142;
    --chip:#0f1625; --chipLine:#2a3750;
    --btn:#0f1522; --btn-line:#2c3a55; --btn-ink:#eef1f5; --btn-active:#182238;
    --prog-start:#67e8f9; --prog-end:#a78bfa;
    --tick-bg:#0e1912; --tick-line:#2d5a3a; --tick-on-ring:rgba(34,197,94,.35); --tick-on-line:#16a34a;
  }
  :root[data-theme="light"]{
    --bg:#f5f7fb; --card:#ffffff; --ink:#0e0f12; --muted:#606b7a; --line:#dbe1ea;
    --chip:#eef2f8; --chipLine:#d5dde8;
    --btn:#f3f6fb; --btn-line:#cfd7e5; --btn-ink:#0e0f12; --btn-active:#e8eef8;
    --prog-start:#06b6d4; --prog-end:#8b5cf6;
    --tick-bg:#eef8f1; --tick-line:#b9e3c6; --tick-on-ring:rgba(22,163,74,.25); --tick-on-line:#16a34a;
  }

  /* ---------- BASE ---------- */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    font-size:var(--fs-base); -webkit-tap-highlight-color:transparent;
  }

  header{
    position:sticky; top:0; z-index:50;
    background:color-mix(in srgb, var(--bg) 92%, transparent);
    backdrop-filter: blur(8px);
    border-bottom:1px solid var(--line);
  }
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  h1{margin:0 0 6px;font-size:clamp(18px,4.5vw,24px)}
  .sub{color:var(--muted);font-size:13px}

  /* Controls */
  .controls{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
  @media (min-width:780px){
    .controls{grid-template-columns:1fr 180px 180px auto auto auto auto}
  }
  .input, select, button{
    height:var(--touch); border-radius:var(--radius-input);
    border:1px solid var(--line); background:var(--btn); color:var(--btn-ink);
  }
  .input, select{padding:0 12px}
  button{padding:0 12px; cursor:pointer}
  button:active{transform:scale(.98)}
  .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{padding:8px 10px;border:1px solid var(--chipLine);border-radius:999px;background:var(--chip);font-size:14px;color:var(--muted)}
  .theme-toggle{display:flex;align-items:center;gap:8px}

  /* Global panel */
  .panel{margin-top:12px;background:var(--card);border:1px solid var(--line);border-radius:var(--radius-card);padding:12px}
  .stats{display:flex;gap:10px;align-items:center}
  .pct{min-width:46px;text-align:right;color:var(--muted);font-variant-numeric:tabular-nums}
  .bar{height:10px;border-radius:999px;background:color-mix(in srgb, var(--bg) 75%, #000 0%);border:1px solid var(--line);overflow:hidden}
  .fill{height:100%;width:0}
  .ok{background:linear-gradient(90deg,var(--prog-start),var(--prog-end))}
  .warn{background:linear-gradient(90deg,#f43f5e,#f59e0b)}
  .small{color:var(--muted);font-size:12px;margin-left:auto}

  /* Grid */
  main{padding:var(--gap-page);max-width:980px;margin:0 auto}
  .grid{
    display:grid;
    gap:20px;               /* ++ espacement entre cartes */
    grid-template-columns:1fr;
  }
  @media (min-width:640px){
    .grid{grid-template-columns:repeat(auto-fit,minmax(350px,1fr))}
  }

  /* Card */
  .card{
    display:grid; gap:var(--gap-card);
    background:var(--card); border:1px solid var(--line); border-radius:calc(var(--radius-card) + 2px);
    padding:14px;
  }
  .name{font-weight:800;font-size:18px;line-height:1.2}
  .loc{color:var(--ink);opacity:.9}
  .cond{color:var(--muted);font-style:italic}
  .rowbar{display:flex;align-items:center;gap:10px;margin-top:2px}
  .checklist{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
  .tick{
    width:var(--touch); height:var(--touch);
    border-radius:var(--radius-tick);
    border:1px solid var(--tick-line); background:var(--tick-bg);
    display:inline-flex; align-items:center; justify-content:center;
    font-size:20px; cursor:pointer; user-select:none;
    box-shadow:0 1px 0 rgba(0,0,0,.25) inset; transition:transform .06s ease, box-shadow .15s ease;
  }
  .tick[data-on="true"]{box-shadow:0 0 0 3px var(--tick-on-ring) inset, 0 0 0 1px var(--tick-on-line)}
  .tick:active{transform:scale(.98)}
  .count{color:var(--muted);font-size:12px;margin-left:auto}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>üìú Progression Animaux L√©gendaires RDO</h1>
    <div class="sub">Cartes optimis√©es iPhone ‚Ä¢ Sauvegarde locale ‚Ä¢ Th√®me clair/sombre</div>

    <div class="controls">
      <input id="q" class="input" type="search" placeholder="Rechercher (animal, lieu, condition)‚Ä¶" inputmode="search"/>
      <select id="fMission" title="Filtre mission">
        <option value="">Mission ‚Äî Tous</option>
        <option value="mission">Mission uniquement</option>
        <option value="libre">Hors mission</option>
      </select>
      <select id="fTag" title="Filtre condition">
        <option value="">Condition ‚Äî Toutes</option>
        <option value="aube">Aube</option>
        <option value="crepuscule">Cr√©puscule</option>
        <option value="nuit">Nuit</option>
        <option value="journee">Journ√©e</option>
        <option value="pluie">Pluie</option>
        <option value="brouillard">Brouillard</option>
        <option value="orage">Orage</option>
        <option value="clair">Temps clair</option>
      </select>
      <button id="checkAll">Cocher visibles</button>
      <button id="uncheckAll">D√©cocher visibles</button>
      <button id="resetAll">R√©initialiser</button>
      <div class="theme-toggle">
        <button id="themeBtn" title="Basculer clair/sombre">üåì Th√®me</button>
      </div>
    </div>

    <div class="panel">
      <div class="stats">
        <strong>Progression globale</strong>
        <div class="pct" id="gPct">0%</div>
      </div>
      <div class="bar" style="margin:8px 0 6px"><div class="fill warn" id="gFill"></div></div>
      <div class="stats"><span class="small" id="gCount">0 / 0 actions</span></div>
      <div class="legend">
        <span class="chip">üêæ Pist√©</span><span class="chip">ü™¶ Tu√©s</span><span class="chip">üî™ D√©pec√©s</span>
        <span class="chip">üîé √âtudi√©</span><span class="chip">üíâ Anesth√©si√©</span><span class="chip">üß¨ √âchantillon</span><span class="chip">üì∏ Photo</span>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="grid" id="cards"></section>
</main>

<script>
/* --------- DATA --------- */
const ACTIONS = [
  { key:"piste", icon:"üêæ" },
  { key:"tue", icon:"ü™¶" },
  { key:"depece", icon:"üî™" },
  { key:"etudie", icon:"üîé" },
  { key:"anesthesie", icon:"üíâ" },
  { key:"echantillon", icon:"üß¨" },
  { key:"photo", icon:"üì∏" }
];
const animals = [
  { name:"Ours esprit dor√©", location:"Big Valley", condition:"Mission" },
  { name:"Ours Owiza", location:"Rivi√®re Dakota", condition:"√Ä l‚Äôaube ou au cr√©puscule" },
  { name:"Ours esprit c√¥tier", location:"Rivi√®re Little Creek", condition:"En journ√©e" },
  { name:"Castor tenebreux", location:"Roanoke Ridge", condition:"Mission" },
  { name:"Castor Zizi", location:"Ownjila", condition:"√Ä l‚Äôaube ou au cr√©puscule" },
  { name:"Castor lunaire", location:"Sud de Elysian Pool, √† l‚Äôest de Van Horn", condition:"√Ä l‚Äôaube ou au cr√©puscule sous la pluie" },
  { name:"Bison Tatanka", location:"Champs p√©trolif√®res de Heartland", condition:"Sous la pluie en journ√©e" },
  { name:"Bison Winyan", location:"Nord du lac Isabella", condition:"De nuit par temps clair" },
  { name:"Bison Payta", location:"Little Creek", condition:"Mission" },
  { name:"Sanglier Cogi", location:"Marais Bluewater", condition:"√Ä l‚Äôaube par temps clair" },
  { name:"Sanglier Wakpa", location:"Marais Stillwater", condition:"Sous la pluie en journ√©e" },
  { name:"Sanglier Icahi", location:"Est de New Austin", condition:"Mission" },
  { name:"Cerf pataugeur", location:"Lac Flat Iron", condition:"En journ√©e par temps clair" },
  { name:"Cerf des neiges", location:"Bassin Aurora", condition:"√Ä l‚Äôaube par temps clair" },
  { name:"Cerf ombr√©", location:"Annesburg", condition:"Mission" },
  { name:"Couguar Iguga", location:"Sud-est des Grandes Plaines (au sud de Blackwater)", condition:"Au cr√©puscule par temps orageux" },
  { name:"Couguar Maza", location:"Mer de Coronado", condition:"√Ä l‚Äôaube par temps clair" },
  { name:"Couguar Sapa", location:"Nord-est de New Austin", condition:"Mission" },
  { name:"Coyote rubigineux", location:"Pike‚Äôs Basin", condition:"Au cr√©puscule" },
  { name:"Coyote d‚Äô√©b√®ne", location:"Sud-est de Strawberry", condition:"√Ä l‚Äôaube et en journ√©e par temps clair" },
  { name:"Coyote laiteux", location:"Blackwater", condition:"Mission" },
  { name:"Wapiti Katata", location:"For√™t de Cumberland", condition:"En journ√©e dans le brouillard" },
  { name:"Wapiti Ozula", location:"Cholla Springs", condition:"Au cr√©puscule et de nuit dans le brouillard" },
  { name:"Wapiti Inahme", location:"Gorge de l‚ÄôAraign√©e", condition:"Mission" },
  { name:"Renard crois√©", location:"Bayou Nwa", condition:"Mission" },
  { name:"Renard marbr√©", location:"Colter", condition:"√Ä l‚Äôaube ou au cr√©puscule par temps clair" },
  { name:"Renard Ota", location:"Ouest de Rhodes", condition:"√Ä l‚Äôaube ou au cr√©puscule par temps clair" },
  { name:"Alligator dor√©", location:"Marais de Lagras (au nord de Saint Denis)", condition:"√Ä l‚Äôaube dans le brouillard" },
  { name:"Alligator Teca", location:"Rivi√®re Lannahechee (au sud de Saint Denis)", condition:"De nuit par temps orageux" },
  { name:"Alligator √† bandes", location:"Saint Denis", condition:"Mission" },
  { name:"Orignal flocon de neige", location:"Lagune Barrow", condition:"De nuit sous la pluie" },
  { name:"Orignal roux", location:"Tall Trees", condition:"Mission" },
  { name:"Orignal chevalier", location:"Nord de la rivi√®re Kamassa", condition:"En journ√©e" },
  { name:"Panth√®re noctivague", location:"Bolger Glade", condition:"Au cr√©puscule dans le brouillard" },
  { name:"Panth√®re fant√¥me", location:"Merkins Waller et Macomb‚Äôs", condition:"De nuit sous la pluie" },
  { name:"Panth√®re Iwakta", location:"Pr√®s du manoir Braithwaite", condition:"Mission" },
  { name:"Mouflon corne craie", location:"Sud de Cottora Springs", condition:"En journ√©e par temps clair" },
  { name:"Mouflon corne gabbro", location:"Rio Bravo", condition:"√Ä l‚Äôaube et en journ√©e par temps clair" },
  { name:"Mouflon corne rutile", location:"Rio Bravo et Cholla Springs", condition:"Mission" },
  { name:"Loup √©meraude", location:"O‚ÄôCreagh‚Äôs Run", condition:"De nuit" },
  { name:"Loup d‚Äôonyx", location:"Sud du ravin Calumet et Cottora Springs", condition:"De nuit par temps clair" },
  { name:"Loup pierre de lune", location:"Nord de la for√™t de Cumberland", condition:"Mission" }
];

/* --------- THEME --------- */
const THEME_KEY = "rdo_theme";
function applyTheme(t){ document.documentElement.setAttribute("data-theme", t); localStorage.setItem(THEME_KEY,t); }
(function initTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  applyTheme(saved || "dark"); // d√©faut sombre
})();
document.getElementById("themeBtn").addEventListener("click", ()=>{
  const cur = document.documentElement.getAttribute("data-theme");
  applyTheme(cur === "dark" ? "light" : "dark");
});

/* --------- HELPERS --------- */
const cards = document.getElementById('cards');
const gFill = document.getElementById('gFill');
const gPct  = document.getElementById('gPct');
const gCount= document.getElementById('gCount');
const q = document.getElementById('q');
const fMission = document.getElementById('fMission');
const fTag = document.getElementById('fTag');

const isOn = key => localStorage.getItem(key)==="true";
const setOn = (key,val)=> localStorage.setItem(key, val ? "true" : "false");
const rowCount = i => ACTIONS.reduce((n,a)=> n + (isOn(`${i}:${a.key}`)?1:0), 0);

const missionFlag = cond => /mission/i.test(cond) ? 'mission' : 'libre';
function tagSet(cond){
  const s = cond.toLowerCase();
  return {
    aube:/aube/.test(s),
    crepuscule:/cr√©puscule|crepuscule/.test(s),
    nuit:/nuit/.test(s),
    journee:/journ√©e|journee/.test(s),
    pluie:/pluie/.test(s),
    brouillard:/brouillard/.test(s),
    orage:/orage/.test(s),
    clair:/clair/.test(s)
  };
}

/* --------- RENDER --------- */
function render(){
  cards.innerHTML = "";
  animals.forEach((a,i)=>{
    const el = document.createElement('article');
    el.className = "card";
    el.dataset.index = i;
    el.dataset.mission = missionFlag(a.condition);
    el.dataset.tags = JSON.stringify(tagSet(a.condition));
    el.innerHTML = `
      <div class="name">${a.name}</div>
      <div class="loc">üìç ${a.location}</div>
      <div class="cond">üß≠ ${a.condition}</div>

      <div class="rowbar">
        <div class="pct" data-pct>0%</div>
        <div class="bar" style="flex:1"><div class="fill warn" data-fill style="width:0%"></div></div>
        <div class="count" data-count>0/${ACTIONS.length}</div>
      </div>

      <div class="checklist" role="group" aria-label="Checklist ${a.name}">
        ${ACTIONS.map(ac=>{
          const key=`${i}:${ac.key}`, on=isOn(key);
          return `<button class="tick" data-key="${key}" data-on="${on}" title="${ac.key}">${ac.icon}</button>`;
        }).join('')}
      </div>
    `;
    cards.appendChild(el);
    updateRow(i);
  });

  cards.querySelectorAll('.tick').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const key = btn.dataset.key;
      const now = btn.getAttribute('data-on') !== "true";
      btn.setAttribute('data-on', String(now));
      setOn(key, now);
      const idx = key.split(':')[0];
      updateRow(idx);
      updateGlobal();
    }, {passive:true});
  });

  applyFilters();
  updateGlobal();
}

function updateRow(i){
  const card = cards.querySelector(`.card[data-index="${i}"]`);
  if(!card) return;
  const done = rowCount(i);
  const pct  = Math.round(done / ACTIONS.length * 100);
  const fill = card.querySelector('[data-fill]');
  fill.style.width = pct + "%";
  fill.classList.toggle('ok', pct>=50);
  fill.classList.toggle('warn', pct<50);
  card.querySelector('[data-pct]').textContent = pct + "%";
  card.querySelector('[data-count]').textContent = `${done}/${ACTIONS.length}`;
}

function updateGlobal(){
  const total = animals.length * ACTIONS.length;
  let checked = 0;
  animals.forEach((_,i)=> checked += rowCount(i));
  const pct = total ? Math.round(checked/total*100) : 0;
  gFill.style.width = pct + "%";
  gFill.classList.toggle('ok', pct>=50);
  gFill.classList.toggle('warn', pct<50);
  gPct.textContent = pct + "%";
  gCount.textContent = `${checked} / ${total} actions`;
}

/* --------- FILTERS --------- */
function applyFilters(){
  const text = q.value.trim().toLowerCase();
  const missionVal = fMission.value;
  const tagVal = fTag.value;

  cards.querySelectorAll('.card').forEach(card=>{
    const i = +card.dataset.index;
    const a = animals[i];
    let visible = true;

    if (text){
      const hay = `${a.name} ${a.location} ${a.condition}`.toLowerCase();
      visible = hay.includes(text);
    }
    if (visible && missionVal) visible = card.dataset.mission === missionVal;
    if (visible && tagVal){
      const tags = JSON.parse(card.dataset.tags);
      visible = !!tags[tagVal];
    }
    card.style.display = visible ? "" : "none";
  });
}
q.addEventListener('input', applyFilters, {passive:true});
fMission.addEventListener('change', applyFilters);
fTag.addEventListener('change', applyFilters);

/* --------- BULK --------- */
document.getElementById('checkAll').addEventListener('click', ()=>{
  cards.querySelectorAll('.card').forEach(card=>{
    if(card.style.display==="none") return;
    const idx = card.dataset.index;
    ACTIONS.forEach(a=>{
      const k = `${idx}:${a.key}`;
      if(!isOn(k)) setOn(k,true);
      const b = card.querySelector(`.tick[data-key="${k}"]`);
      if(b) b.setAttribute('data-on','true');
    });
    updateRow(idx);
  });
  updateGlobal();
});
document.getElementById('uncheckAll').addEventListener('click', ()=>{
  cards.querySelectorAll('.card').forEach(card=>{
    if(card.style.display==="none") return;
    const idx = card.dataset.index;
    ACTIONS.forEach(a=>{
      const k = `${idx}:${a.key}`;
      if(isOn(k)) setOn(k,false);
      const b = card.querySelector(`.tick[data-key="${k}"]`);
      if(b) b.setAttribute('data-on','false');
    });
    updateRow(idx);
  });
  updateGlobal();
});
document.getElementById('resetAll').addEventListener('click', ()=>{
  animals.forEach((_,i)=> ACTIONS.forEach(a=> localStorage.removeItem(`${i}:${a.key}`)));
  render();
});

/* --------- INIT --------- */
render();
</script>
</body>
</html>
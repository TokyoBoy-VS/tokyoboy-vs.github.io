<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat Export â€“ L1K1â„ </title>
  <!-- RÃ©cupÃ¨re tes variables CSS depuis :root -->
  <link rel="stylesheet" href="assets/styles.css" />
  <style>
    /* Mini-header fixe sous la navbar principale */
    .mini-header {
      position: sticky;
      top: 4rem; /* Ajuste selon la hauteur rÃ©elle de ton header */
      background: var(--card-bg);
      padding: 0.75rem 1rem;
      box-shadow: 0 1px 3px var(--shadow-color);
      z-index: 90;
    }
    .mini-header h2 {
      font-size: 1.25rem;
      margin: 0;
    }
    .mini-header h2 b { color: var(--accent-color); }
    .mini-header h2 i { color: var(--fg-color); }

    /* Container des bulles */
    .chat-container {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .bubble {
      max-width: 70%;
      background: var(--card-bg);
      padding: 0.75rem 1rem;
      border-radius: 12px;
      box-shadow: 0 1px 2px var(--shadow-color);
      position: relative;
    }
    .bubble.received {
      align-self: flex-start;
      border-top-left-radius: 0;
    }
    .bubble.sent {
      align-self: flex-end;
      border-top-right-radius: 0;
      background: var(--accent-color);
      color: #fff;
    }
    .bubble .meta {
      font-size: 0.85rem;
      color: var(--fg-color);
      opacity: 0.8;
      margin-bottom: 0.25rem;
    }
    .bubble .content {
      margin-bottom: 0.5rem;
    }
    .bubble .id {
      font-size: 0.75rem;
      opacity: 0.6;
      text-align: right;
    }
  </style>
</head>
<body>
  <!-- Reprendre ton <header> existant -->
  <header id="site-header">â€¦</header>

  <!-- Formulaire de saisie -->
  <section style="padding:1rem; background: var(--card-bg);">
    <label>
      Ton Discord ID :
      <input type="text" id="userIdInput" placeholder="372682865370202125" />
    </label>
    <label style="margin-left:1rem;">
      Fichier JSON :
      <input type="file" id="fileInput" accept=".json" />
    </label>
  </section>

  <!-- Mini-header (rempli dynamiquement) -->
  <section class="mini-header" id="chatHeader" style="display:none;">
    <h2>
      #<b id="channelName"></b> (<i id="channelId"></i>)
    </h2>
  </section>

  <!-- Conteneur des messages -->
  <section class="chat-container" id="chatContainer"></section>

  <script>
    const userIdInput = document.getElementById('userIdInput');
    const fileInput   = document.getElementById('fileInput');
    const chatHeader  = document.getElementById('chatHeader');
    const channelName = document.getElementById('channelName');
    const channelId   = document.getElementById('channelId');
    const chatCont    = document.getElementById('chatContainer');

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      const userId = userIdInput.value.trim();
      if (!userId) return alert("Entre ton ID Discord d'abord ! ðŸš€");

      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          // Affiche le mini-header
          channelName.textContent = data.channel_name;
          channelId.textContent   = data.channel_id;
          chatHeader.style.display = 'block';
          // Vide les anciennes bulles
          chatCont.innerHTML = '';
          // GÃ©nÃ¨re chaque message
          data.messages.forEach(msg => {
            const div = document.createElement('div');
            div.classList.add('bubble');
            // class selon envoi/reÃ§u
            if (msg.author_id.toString() === userId) {
              div.classList.add('sent');
            } else {
              div.classList.add('received');
            }
            div.innerHTML = `
              <div class="meta">
                <b>${msg.author_name}</b> (<i>${msg.author_id}</i>)<br>
                <small>${msg.role} â€“ ${new Date(msg.timestamp).toLocaleString()}</small>
              </div>
              <div class="content">${msg.content}</div>
              <div class="id">${msg.message_id}</div>
            `;
            chatCont.appendChild(div);
          });
        } catch (e) {
          alert("Fichier JSON invalide ! ðŸ“›");
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
